<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="css/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="apple-touch-icon" type="image/png" href="img/favicon/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="img/favicon/icon-192x192.png">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>uwuzuã‚µãƒ¼ãƒãƒ¼ãƒªã‚¹ãƒˆ</title>
</head>
<body>
<header class="header" id="header">
    <div class="view">
        <div class="logo">
            <img src="img/uwuzucolorlogo.svg">
            <p>ServerList</p>
        </div>
        <a href="https://www.uwuzu.com/">uwuzuå…¬å¼ã‚µã‚¤ãƒˆ</a>
    </div>
</header>
<main>
    <h1>ã‚µãƒ¼ãƒãƒ¼ãƒªã‚¹ãƒˆ</h1>
    <p>â€»ã“ã®ãƒšãƒ¼ã‚¸ã¯è©¦é¨“çš„ãªã‚‚ã®ã§ã™ã€‚<br>æ­£ã—ãå‹•ä½œã—ãªã„å ´åˆã¯<a href="https://docs.uwuzu.com/docs/uwuzuserver/serverlist/">å¾“æ¥ã®ç‰©</a>ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯uwuzuã‚’å°å…¥æ¸ˆã¿ã®ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒªã‚¹ãƒˆã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ï¼<br>
        ã‚µãƒ¼ãƒãƒ¼ç®¡ç†è€…æ§˜ã‚ˆã‚Šæ²è¼‰ã‚’ã”å¸Œæœ›ã•ã‚Œã‚‹å ´åˆã¯ã ã„ã¡ã¾ã‚‹ã®Discordã‚„Twitter DMã€ãƒ¡ãƒ¼ãƒ«ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚</p>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã«ã™ã¹ã¦ã®uwuzuã‚µãƒ¼ãƒãƒ¼ãŒæ²è¼‰ã•ã‚Œã¦ã„ã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚<br>
        ã‚µãƒ¼ãƒãƒ¼ã®APIã«æ¥ç¶šã§ããªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
    <p>çµ±è¨ˆæƒ…å ±åŠã³ã‚µãƒ¼ãƒãƒ¼ã®æƒ…å ±ã¯1æ™‚é–“ã«1åº¦æ›´æ–°ã•ã‚Œã¾ã™ï¼(éå»ã®çµ±è¨ˆæƒ…å ±ã¯æœˆå˜ä½ã§è¨˜éŒ²ã—ã¦ã„ãŸã‚‚ã®ãŒå«ã¾ã‚Œã¾ã™ã€‚è¨˜éŒ²ã®ãªã„ç©ºç™½æœŸé–“ã‚‚å«ã¾ã‚Œã¾ã™ã€‚)</p>
    <div id="loading" class="loading" style="display: none;">
        ğŸ¤”
    </div>
    <div id="All" class="toukei" style="display: none;">
        <h3>uwuzuå…¨ä½“ã®çµ±è¨ˆæƒ…å ±</h3>
        <div class="flexbox">
            <div class="about">
                <div class="p2">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                <p id="All_users"></p>
            </div>
            <div class="about">
                <div class="p2">ãƒ¦ãƒ¼ã‚ºæ•°</div>
                <p id="All_ueuse"></p>
            </div>
            <div class="about">
                <div class="p2">ã‚µãƒ¼ãƒãƒ¼æ•°</div>
                <p id="All_server"></p>
            </div>
        </div>
    </div>

    <div class="flexbox">
        <div class="chart_line">
            <canvas id="growthChart" width="300px" height="300px"></canvas>
        </div>
        <div class="chart_circle">
            <canvas id="shareChart" width="300px" height="300px"></canvas>
        </div>
    </div>
    

</main>
<footer>
    <a href="https://daichimarukana.com">Â© 2022 - 2024 daichimarukana</a>
    <a href="https://www.uwuzu.com/" class="uwuzu">uwuzu</a>
</footer>
</body>
<script>
window.onload = function() {
    $("#loading").show();
    fetch('/stats.json')
        .then(response => response.json())
        .then(data => {
            $('#All_users').text(data.all_user);
            $('#All_ueuse').text(data.all_ueuse);
            $('#All_server').text(data.all_server);

            data.servers.sort((a, b) => {
                const usersA = a.data ? a.data.server_info.usage.users : 0;
                const usersB = b.data ? b.data.server_info.usage.users : 0;
                return usersB - usersA;
            });

            const validServers = data.servers.filter(s => s.data !== null);
            const labels = validServers.map(s => s.domain);
            const userCounts = validServers.map(s => s.data.server_info.usage.users);
            const ctxShare = document.getElementById('shareChart').getContext('2d');
            new Chart(ctxShare, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: userCounts,
                        backgroundColor: [
                            '#FFC832', '#FFC832aa', '#FFC83255', '#FFC83211'
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.raw || 0;
                                    let total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    let percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value}äºº (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            data.servers.forEach(item => {
                let html = '';
                if (item.error) {
                    html = `
                    <div class="mes_textbox">
                        <div class="icon_and_s_namebox">
                            <div class="icon"><img src="/img/error.png"></div>
                            <div class="s_namebox">
                                <h2>Error</h2>
                                <h3><a href="https://${item.domain}">${item.domain}</a></h3>
                            </div>
                        </div>
                        <h3>èª¬æ˜</h3>
                        <p>ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãŒã§ãã¾ã›ã‚“ã§ã—ãŸ<br>Status: ${item.error}</p>
                    </div>`;
                } else {
                    const info = item.data.server_info;
                    const sw = item.data.software;
                    const invitation = info.invitation_code ? '<div class="invitation_code">æ‹›å¾…ã‚³ãƒ¼ãƒ‰å¿…é ˆ</div>' : '';
                    const icon = info.server_icon ? info.server_icon : '/img/uwuzuicon.png';

                    html = `
                    <div class="mes_textbox">
                        <div class="icon_and_s_namebox">
                            <div class="icon"><img src="${icon}"></div>
                            <div class="s_namebox">
                                <h2>${info.server_name}</h2>
                                <h3><a href="https://${item.domain}">${item.domain}</a></h3>
                            </div>
                            ${invitation}
                        </div>
                        <h3>èª¬æ˜</h3>
                        <p>${info.server_description}</p>
                        <hr>
                        <div class="btmzone">
                            <div class="left">
                                <div class="about"><div class="p2">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div><p>${info.usage.users}</p></div>
                                <div class="about"><div class="p2">ãƒ¦ãƒ¼ã‚ºæ•°</div><p>${info.usage.ueuse}</p></div>
                            </div>
                            <div class="right">
                                <div class="server"><div class="p2">ã‚µãƒ¼ãƒãƒ¼æƒ…å ±</div><p>${sw.name} ${sw.version}</p></div>
                                <div class="server"><div class="p2">ç®¡ç†è€…</div><p>${info.adminstor.name}</p></div>
                            </div>
                        </div>
                    </div>`;
                }
                $('main').append(html);
            });

            $("#loading").hide();
            $("#All").show();
        });

    fetch('/history.json')
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('growthChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [
                        {
                            label: 'ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°',
                            data: data.map(d => d.users),
                            borderColor: '#56c138',
                            backgroundColor: '#56c13811',
                            yAxisID: 'y-users',
                            tension: 0.0,
                            fill: true
                        },
                        {
                            label: 'ç·ãƒ¦ãƒ¼ã‚ºæ•°',
                            data: data.map(d => d.ueuse),
                            borderColor: '#ffc832',
                            backgroundColor: '#ffc83211',
                            yAxisID: 'y-ueuse',
                            tension: 0.0,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        'y-users': {
                            type: 'linear',
                            position: 'left',
                            title: { display: true, text: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°' }
                        },
                        'y-ueuse': {
                            type: 'linear',
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'ãƒ¦ãƒ¼ã‚ºæ•°' }
                        }
                    }
                }
            });
        });
}
</script>
</html>